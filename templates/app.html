<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Pocket pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="app-wrapper">

    <!-- –≠–ö–†–ê–ù0: –ó–ê–ì–†–£–ó–ö–ê -->
    <div id="loader-view" class="view active">
        <div class="card">
            <div class="spinner"></div>
            <p data-translate-key="loading"></p>
        </div>
    </div>
    
    <!-- –≠–ö–†–ê–ù 0.1: –û–®–ò–ë–ö–ê -->
    <div id="error-view" class="view">
        <div class="card">
            <p data-translate-key="error_text"></p>
        </div>
    </div>

    <!-- –ë–õ–û–ö 1: –û–ù–ë–û–†–î–ò–ù–ì -->
    <div id="onboarding-1-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="onb1_title"></h1>
            <h2 class="subtitle">Pocket Option</h2>
            <p class="description" data-translate-key="onb1_desc"></p>
            <div class="stats-container">
                <div class="stat-item"><div class="value">1000+</div><div class="label" data-translate-key="onb1_stat1"></div></div>
                <div class="stat-item"><div class="value">95%</div><div class="label" data-translate-key="onb1_stat2"></div></div>
                <div class="stat-item"><div class="value">24/7</div><div class="label" data-translate-key="onb1_stat3"></div></div>
            </div>
            <div class="nav-buttons full-width">
                <button class="main-button" id="btn-onb1-next" data-translate-key="start_btn"></button>
            </div>
        </div>
    </div>
    <div id="onboarding-2-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="onb2_title"></h1>
            <h2 class="subtitle">Pocket Option</h2>
            <p class="description" data-translate-key="onb2_desc"></p>
            <ul class="features-list">
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb2_feat1"></span></li>
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb2_feat2"></span></li>
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb2_feat3"></span></li>
            </ul>
            <div class="nav-buttons">
                <button class="back-button" id="btn-onb2-back" data-translate-key="back_btn"></button>
                <button class="main-button" id="btn-onb2-next" data-translate-key="next_btn"></button>
            </div>
        </div>
    </div>
    <div id="onboarding-3-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="onb3_title"></h1>
            <h2 class="subtitle">Pocket Option</h2>
            <p class="description" data-translate-key="onb3_desc"></p>
             <ul class="features-list">
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb3_feat1"></span></li>
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb3_feat2"></span></li>
            </ul>
            <div class="nav-buttons">
                <button class="back-button" id="btn-onb3-back" data-translate-key="back_btn"></button>
                <button class="main-button" id="btn-onb3-next" data-translate-key="onb3_btn"></button>
            </div>
        </div>
    </div>
    <div id="onboarding-4-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="onb4_title"></h1>
            <p class="description" data-translate-key="onb4_desc"></p>
            <ul class="features-list">
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb4_feat1"></span></li>
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb4_feat2"></span></li>
                <li><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg><span data-translate-key="onb4_feat3"></span></li>
            </ul>
            <div class="nav-buttons">
                <button class="back-button" id="btn-onb4-back" data-translate-key="back_btn"></button>
                <button class="main-button" id="btn-register" data-translate-key="onb4_btn"></button>
            </div>
        </div>
    </div>

    <!-- –ë–õ–û–ö 2: –ü–û–°–õ–ï –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò -->
    <div id="post-reg-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="postreg_title"></h1>
            <p class="description" data-translate-key="postreg_desc"></p>
            <p class="description" data-translate-key="postreg_warn"></p>
        </div>
    </div>

    <!-- –ë–õ–û–ö 3: –ü–û–°–õ–ï –î–ï–ü–û–ó–ò–¢–ê -->
    <div id="post-deposit-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="postdep_title"></h1>
            <p class="description" data-translate-key="postdep_desc"></p>
            <p class="description" data-translate-key="postdep_profit"></p>
            <div class="signal-buttons">
                <button class="signal-button" id="btn-vip-signal">
                    <div class="signal-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14 3c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1v-1h14v1z"/></svg>
                    </div>
                    <div class="signal-text">
                        <h3 data-translate-key="vip_signal_title"></h3>
                        <p data-translate-key="vip_signal_desc"></p>
                    </div>
                </button>
                <button class="signal-button" id="btn-simple-signal">
                    <div class="signal-icon">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="28" height="28"><path fill="currentColor" d="M7 2v11h3v9l7-12h-4l4-8z"/></svg>
                    </div>
                    <div class="signal-text">
                        <h3 data-translate-key="simple_signal_title"></h3>
                        <p data-translate-key="simple_signal_desc"></p>
                    </div>
                </button>
            </div>
        </div>
    </div>
    
    <!-- –ë–õ–û–ö 4: –≠–ö–†–ê–ù–´ –î–ï–ô–°–¢–í–ò–ô -->
    <div id="wip-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="wip_title"></h1>
            <p class="description" data-translate-key="wip_desc"></p>
            <div class="nav-buttons full-width">
                 <button class="back-button" id="btn-wip-back" data-translate-key="back_btn"></button>
            </div>
        </div>
    </div>
    
    <!-- –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ -->
    <div id="signal-active-view" class="view">
        <div class="card signal-card">
            <div id="signal-stage-1"><p class="emoji-spinner">‚è≥</p><h1 class="title" data-translate-key="search_title"></h1><p class="description" data-translate-key="search_desc"></p></div>
            <div id="signal-stage-2" style="display: none;"><button class="main-button" id="btn-get-signal" data-translate-key="signal_get_btn"></button></div>
            <div id="signal-stage-3" style="display: none;">
                <p class="signal-step" id="signal-status-ready" data-translate-key="signal_ready"></p>
                <p class="signal-step" id="signal-pair"></p>
                <p class="signal-step" id="signal-status-exp-soon" data-translate-key="signal_exp_soon"></p>
                <p class="signal-step" id="signal-expiration" style="display: none;"></p>
            </div>
            <div id="signal-stage-4" style="display: none; margin-top: 20px;">
                <p class="description" data-translate-key="signal_confirm_prompt"></p>
                <button class="main-button" id="btn-confirm-ready" data-translate-key="signal_confirm_btn"></button>
            </div>
            <div id="signal-stage-5" style="display: none;">
                <p class="signal-step" id="signal-direction"></p>
                <div id="signal-result-container" style="display: none;">
                    <p class="signal-step signal-result" id="signal-result-win" data-translate-key="signal_win"></p>
                    <div id="signal-win-buttons" style="display: none;">
                        <div class="button-row">
                            <button class="action-button" id="btn-next-signal" data-translate-key="next_signal_btn"></button>
                            <button class="action-button vip" id="btn-goto-vip" data-translate-key="want_vip_btn"></button>
                        </div>
                        <button class="action-button lost full-width" id="btn-i-lost" data-translate-key="i_lost_btn"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù "–Ø –ü–†–û–ò–ì–†–ê–õ" -->
    <div id="loss-view" class="view">
        <div class="card">
            <h1 class="title" data-translate-key="loss_title"></h1>
            <p class="description" data-translate-key="loss_desc"></p>
            <div class="nav-buttons-vertical">
                <button class="main-button" id="btn-next-from-loss" data-translate-key="next_signal_btn"></button>
                <button class="secondary-button" id="btn-vip-from-loss" data-translate-key="want_vip_btn"></button>
            </div>
        </div>
    </div>

</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.setHeaderColor('#12171f');
    tg.setBackgroundColor('#12171f');

    const REGISTER_LINK_TEMPLATE = "https://u3.shortink.io/register?utm_campaign=825192&utm_source=affiliate&utm_medium=sr&a=PDSrNY9vG5LpeF&ac=1d&code=50START";
    
    const TRANSLATIONS = {
        'ru': {
            'loading': '–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...', 'error_text': '–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ú–µ–Ω—é" –≤ –±–æ—Ç–µ.', 'start_btn': '–ù–∞—á–∞—Ç—å >', 'next_btn': '–î–∞–ª–µ–µ >', 'back_btn': '< –ù–∞–∑–∞–¥',
            'onb1_title': 'Premium —Å–∏–≥–Ω–∞–ª—ã', 'onb1_desc': '–ü–æ–ª—É—á–∞–π—Ç–µ —Ç–æ—á–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 95%', 'onb1_stat1': '–¢—Ä–µ–π–¥–µ—Ä—ã', 'onb1_stat2': '–¢–æ—á–Ω–æ—Å—Ç—å', 'onb1_stat3': '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
            'onb2_title': 'VIP –°—Ç–∞—Ç—É—Å', 'onb2_desc': '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É —ç–ª–∏—Ç–Ω—ã—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤', 'onb2_feat1': '–û–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã: 5-10/–¥–µ–Ω—å', 'onb2_feat2': 'VIP —Å–∏–≥–Ω–∞–ª—ã: 20+/–¥–µ–Ω—å', 'onb2_feat3': '–¢–æ—á–Ω–æ—Å—Ç—å VIP: –¥–æ 95%',
            'onb3_title': '–ù–∞—á–Ω–∏—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å', 'onb3_desc': '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Ç—ã—Å—è—á–∞–º —É—Å–ø–µ—à–Ω—ã—Ö —Ç—Ä–µ–π–¥–µ—Ä–æ–≤ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é –ø—Ä–∏–±—ã–ª—å —É–∂–µ —Å–µ–≥–æ–¥–Ω—è', 'onb3_feat1': '–ü—Ä–∏–±—ã–ª—å: –¥–æ 95%', 'onb3_feat2': '–°–∫–æ—Ä–æ—Å—Ç—å: 1-15 –º–∏–Ω.', 'onb3_btn': '–ù–∞—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤–∞—Ç—å >',
            'onb4_title': '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Pocket Option', 'onb4_desc': '–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —É –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞', 'onb4_feat1': '–õ–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±—Ä–æ–∫–µ—Ä', 'onb4_feat2': '–ë—ã—Å—Ç—Ä—ã–µ –≤—ã–ø–ª–∞—Ç—ã', 'onb4_feat3': '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç $10', 'onb4_btn': '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è >',
            'postreg_title': '–ö–ª–∞—Å—Å–Ω–æ! –°—Ç–∞—Ä—Ç—É–µ–º', 'postreg_desc': '–ò –ø–æ–º–Ω–∏, —á—Ç–æ —Å –ª—é–±–æ–π —Å—É–º–º–æ–π –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∏—á—å –≤—ã—Å–æ—Ç!', 'postreg_warn': '–¢–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–π –¥–µ–ø–æ–∑–∏—Ç. –Ø –ø—Ä–æ–≤–µ—Ä—é –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞, –Ω–µ —à—É—Ç–∏ —Å–æ –º–Ω–æ–π.',
            'postdep_title': '–°—É–ø–µ—Ä, —Ç–≤–æ–π –¥–µ–ø–æ–∑–∏—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω!', 'postdep_desc': '–í–æ—Ç —Ç–≤–æ—è —Ç–æ—á–∫–∞ –ê - <b>{deposit_sum}</b>', 'postdep_profit': '–ó–∞ 5-10 —Å–∏–≥–Ω–∞–ª–æ–≤ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å ~<b>{profit_sum}</b><br>–ù–µ –±–æ–π—Å—è –ø–æ—Ç–µ—Ä—å, –æ–Ω–∏ –µ—Å—Ç—å —É –≤—Å–µ—Ö. –í –¥–æ–ª–≥–æ—Å—Ä–æ–∫–µ —Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—à—å!',
            'vip_signal_title': 'üëë –í–ò–ü –°–∏–≥–Ω–∞–ª', 'vip_signal_desc': '–í–ò–ü —Å–∏–≥–Ω–∞–ª—ã - —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ —Ç—Ä–µ–π–¥–∏–Ω–≥–µ. –ó–¥–µ—Å—å –≤—ã–¥–∞—é—Ç—Å—è –ª—É—á—à–∏–µ —Å–∏–≥–Ω–∞–ª—ã.', 'simple_signal_title': '–ü—Ä–æ—Å—Ç–æ–π —Å–∏–≥–Ω–∞–ª', 'simple_signal_desc': '–Ø –ø—Ä–∏—à–ª—é –≤–∞–ª—é—Ç–Ω—É—é –ø–∞—Ä—É, –≤—Ä–µ–º—è —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ –∏ —Å–∞–º —Å–∏–≥–Ω–∞–ª (–≤–≤–µ—Ä—Ö –∏–ª–∏ –≤–Ω–∏–∑). –ì–æ—Ç–æ–≤?',
            'wip_title': '–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'wip_desc': '–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞.',
            'search_title': '–Ø –≤ –ø–æ–∏—Å–∫–µ —Å–∏–≥–Ω–∞–ª–∞', 'search_desc': '–ü–æ–¥–≥–æ—Ç–æ–≤—å—Å—è, –∑–∞–π–¥–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É, –Ω–∞–¥–æ –±—É–¥–µ—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä–æ',
            'signal_get_btn': '–ü–æ–ª—É—á–∏—Ç—å —Å–∏–≥–Ω–∞–ª', 'signal_ready': '–ì–æ—Ç–æ–≤–æ!', 'signal_pair_select': '–í—ã–±–µ—Ä–∏ –≤–∞–ª—é—Ç–Ω—É—é –ø–∞—Ä—É <b>{pair}</b>', 'signal_exp_soon': '–°–ï–ô–ß–ê–° —Å–∫–∞–∂—É –≤—Ä–µ–º—è —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏', 'signal_exp_time': '–í—Ä–µ–º—è —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏ <b>{exp}</b>',
            'signal_buy': '–ü–û–ö–£–ü–ê–ô üü¢', 'signal_sell': '–ü–†–û–î–ê–í–ê–ô üî¥',
            'signal_confirm_prompt': '–ù–∞–∂–º–∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –±—É–¥–µ—à—å –≥–æ—Ç–æ–≤ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å!', 'signal_confirm_btn': '–Ø –≥–æ—Ç–æ–≤!',
            'signal_win': '–ü–û–ë–ï–î–ê! üèÜ',
            'next_signal_btn': '–°–ª–µ–¥—É—é—â–∏–π!', 'want_vip_btn': '–•–æ—á—É –í–ò–ü —Å–∏–≥–Ω–∞–ª', 'i_lost_btn': '–Ø –ø—Ä–æ–∏–≥—Ä–∞–ª',
            'loss_title': '–•–º, —Å—Ç—Ä–∞–Ω–Ω–æ! –ê —è –≤—ã–∏–≥—Ä–∞–ª', 'loss_desc': '–î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç—ã —Å–¥–µ–ª–∞–ª —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫. –ß–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç —Ç–∞–∫, —á—Ç–æ –ª—é–¥–∏ —Å—Ç–∞–≤—è—Ç –Ω–µ –≤–æ–≤—Ä–µ–º—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑! –í–ø—Ä–µ–¥—å –±—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ',
        },
        'en': { /* ... –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞—à–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã ... */ }
    };

    let userLang = 'en';

    function applyTranslations(lang, data = {}) {
        const t = TRANSLATIONS[lang];
        document.querySelectorAll('[data-translate-key]').forEach(el => {
            const key = el.getAttribute('data-translate-key');
            if (t[key]) {
                let text = t[key];
                for(const dataKey in data) { text = text.replace(`{${dataKey}}`, data[dataKey]); }
                el.innerHTML = text;
            }
        });
    }

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        const viewElement = document.getElementById(viewId);
        if (viewElement) { viewElement.classList.add('active'); }
    }
    
    function startSignalFlow() {
        showView('signal-active-view');
        
        const stages = ['signal-stage-1', 'signal-stage-2', 'signal-stage-3', 'signal-stage-4', 'signal-stage-5'];
        stages.forEach(id => document.getElementById(id).style.display = 'none');
        document.getElementById('signal-stage-1').style.display = 'block';
        
        document.getElementById('signal-result-container').style.display = 'none';
        document.getElementById('signal-win-buttons').style.display = 'none';

        const getSignalBtn = document.getElementById('btn-get-signal');
        
        setTimeout(() => {
            document.getElementById('signal-stage-1').style.display = 'none';
            document.getElementById('signal-stage-2').style.display = 'block';
        }, 10000);

        getSignalBtn.onclick = () => {
            document.getElementById('signal-stage-2').style.display = 'none';
            document.getElementById('signal-stage-3').style.display = 'block';

            const currencyPairs = ["EUR/RUB OTC", "AUD/USD OTC", "AUD/CAD OTC", "GBP/USD OTC", "EUR/USD OTC"];
            const expirations = ["S15", "S20", "S25", "S30", "S45"];
            const directions = ["buy", "sell"];
            const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            const selectedPair = getRandomItem(currencyPairs);
            const selectedExp = getRandomItem(expirations);
            const selectedDir = getRandomItem(directions);
            
            document.getElementById('signal-pair').innerHTML = TRANSLATIONS[userLang]['signal_pair_select'].replace('{pair}', selectedPair);

            setTimeout(() => {
                document.getElementById('signal-expiration').innerHTML = TRANSLATIONS[userLang]['signal_exp_time'].replace('{exp}', selectedExp);
                document.getElementById('signal-expiration').style.display = 'block';
                document.getElementById('signal-stage-4').style.display = 'block';
                
                const confirmReadyBtn = document.getElementById('btn-confirm-ready');

                confirmReadyBtn.onclick = () => {
                    document.getElementById('signal-stage-3').style.display = 'none';
                    document.getElementById('signal-stage-4').style.display = 'none';
                    document.getElementById('signal-stage-5').style.display = 'block';
                    
                    setTimeout(() => {
                        const signalDirectionEl = document.getElementById('signal-direction');
                        if (selectedDir === 'buy') {
                            signalDirectionEl.className = 'signal-step buy-signal';
                            signalDirectionEl.innerHTML = TRANSLATIONS[userLang]['signal_buy'];
                        } else {
                            signalDirectionEl.className = 'signal-step sell-signal';
                            signalDirectionEl.innerHTML = TRANSLATIONS[userLang]['signal_sell'];
                        }
                        signalDirectionEl.style.display = 'block';
                        
                        const timeValue = parseInt(selectedExp.substring(1));
                        const expirationInMs = timeValue * 1000;

                        setTimeout(() => {
                            document.getElementById('signal-result-container').style.display = 'block';
                            document.getElementById('signal-win-buttons').style.display = 'block'; 
                        }, expirationInMs);

                    }, 6000);
                };

            }, 7000);
        };
    }

    function setupNavigation() {
        document.getElementById('btn-onb1-next').onclick = () => showView('onboarding-2-view');
        document.getElementById('btn-onb2-back').onclick = () => showView('onboarding-1-view');
        document.getElementById('btn-onb2-next').onclick = () => showView('onboarding-3-view');
        document.getElementById('btn-onb3-back').onclick = () => showView('onboarding-2-view');
        document.getElementById('btn-onb3-next').onclick = () => showView('onboarding-4-view');
        document.getElementById('btn-onb4-back').onclick = () => showView('onboarding-3-view');
        document.getElementById('btn-vip-signal').onclick = () => showView('wip-view');
        document.getElementById('btn-simple-signal').onclick = startSignalFlow;
        document.getElementById('btn-wip-back').onclick = () => showView('post-deposit-view');
        
        document.getElementById('btn-next-signal').onclick = startSignalFlow;
        document.getElementById('btn-goto-vip').onclick = () => showView('wip-view');
        document.getElementById('btn-i-lost').onclick = () => showView('loss-view');
        document.getElementById('btn-next-from-loss').onclick = startSignalFlow;
        document.getElementById('btn-vip-from-loss').onclick = () => showView('wip-view');
    }
    
    async function main() {
        if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
            applyTranslations('en');
            showView('error-view');
            return;
        }

        const user = tg.initDataUnsafe.user;
        const userId = user.id;
        userLang = (user.language_code && user.language_code.startsWith('ru')) ? 'ru' : 'en';
        document.documentElement.lang = userLang;
        
        applyTranslations(userLang);
        setupNavigation();
        
        document.getElementById('btn-register').onclick = () => {
            const personalLink = `${REGISTER_LINK_TEMPLATE}&sub_id1=${userId}`;
            tg.openLink(personalLink);
        };

        try {
            const response = await fetch(`/user/${userId}/data`);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();
            
            const hasDeposit = data.events.some(e => e[0] === 'FTD' || e[0] === 'dep');

            if (data.is_registered) {
                if (hasDeposit) {
                    const depositEvent = data.events.find(e => e[0] === 'FTD' || e[0] === 'dep');
                    const depositAmount = parseFloat(depositEvent[1]);
                    const profitAmount = (depositAmount * 3.3).toFixed(2);
                    
                    applyTranslations(userLang, {
                        deposit_sum: `$${depositAmount}`,
                        profit_sum: `$${profitAmount}`
                    });
                    showView('post-deposit-view');
                } else {
                    showView('post-reg-view');
                }
            } else {
                showView('onboarding-1-view');
            }
        } catch (error) {
            console.error("Data loading error:", error);
            showView('error-view');
        }
    }

    document.addEventListener('DOMContentLoaded', main);
</script>

</body>
</html>






